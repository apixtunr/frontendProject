<!-- Bootstrap Icons CDN para íconos -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">

<!-- menu.component.html -->
<div class="sidebar">
  <nav class="nav flex-column">

    <!-- Información del usuario logueado -->
    <div class="user-info" *ngIf="usuarioActual">
      <div class="welcome-text">Bienvenido</div>
      <div class="user-name">{{ usuarioActual.nombre }} {{ usuarioActual.apellido }}</div>
      <div class="user-role">
        <i class="bi bi-person-badge-fill me-1"></i>
        <span *ngIf="esAdmin()" class="role-admin">Administrador</span>
        <span *ngIf="!esAdmin()" class="role-user">Usuario</span>
      </div>
    </div>

    <!-- Mostrar todos los módulos y sus menús -->
    <ng-container *ngFor="let modulo of estructuraMenu">
      <!-- Header del módulo -->
      <div class="nav-link module-header"
           (click)="toggleModulo(modulo.idModulo)"
           [class.active]="moduloAbierto === modulo.idModulo">
        <span class="icon"><i class="bi bi-shield-lock-fill"></i></span>
        <span class="description">{{ modulo.nombre }}</span>
        <span class="chevron" [style.transform]="moduloAbierto === modulo.idModulo ? 'rotate(180deg)' : 'rotate(0deg)'">
          <i class="bi bi-chevron-down"></i>
        </span>
      </div>
      <!-- Submenús del módulo -->
      <div class="sub-menu" [class.open]="moduloAbierto === modulo.idModulo">
        <ng-container *ngFor="let menu of modulo.menus">
          <!-- Solo mostrar el menú si tiene opciones visibles para el usuario -->
          <ng-container *ngIf="getOpcionesVisibles(menu).length > 0">
            <!-- Header del submenú -->
            <div class="nav-link submenu-header"
                 (click)="toggleMenu(menu.idMenu)"
                 [class.active]="menuAbierto === menu.idMenu">
              <span class="icon">
                <i class="bi bi-gear-fill" *ngIf="menu.idMenu === 2" style="color: #ff6b6b;"></i>
                <i class="bi bi-people-fill" *ngIf="menu.idMenu === 3" style="color: #4ecdc4;"></i>
                <i class="bi bi-box-seam" *ngIf="menu.idMenu !== 2 && menu.idMenu !== 3" style="color: #45b7d1;"></i>
              </span>
              <span class="description">{{ menu.nombre }}</span>
              <!-- Badges -->
              <div class="badges">
                <span *ngIf="menu.idMenu === 2 && esAdmin()" class="badge-admin">
                  <i class="bi bi-star-fill me-1"></i>ADMIN
                </span>
                <span *ngIf="menu.idMenu === 2 && !esAdmin()" class="badge-restricted">
                  <i class="bi bi-lock-fill me-1"></i>RESTRINGIDO
                </span>
                <span class="chevron" [style.transform]="menuAbierto === menu.idMenu ? 'rotate(180deg)' : 'rotate(0deg)'">
                  <i class="bi bi-chevron-down"></i>
                </span>
              </div>
            </div>
            <!-- Opciones del submenú -->
            <div class="sub-menu" [class.open]="menuAbierto === menu.idMenu">
              <ng-container *ngFor="let opcion of menu.opciones">
                <a class="nav-link option-link"
                   *ngIf="puedeVerOpcion(opcion, menu.idMenu)"
                   [routerLink]="opcion.url"
                   routerLinkActive="active"
                   [routerLinkActiveOptions]="{exact: true}">
                  <span class="icon"><i class="bi bi-file-earmark-check-fill"></i></span>
                  <span class="description">{{ opcion.nombre }}</span>
                  <span *ngIf="menu.idMenu === 2" class="sensitive-icon">
                    <i class="bi bi-shield-exclamation"></i>
                  </span>
                </a>
              </ng-container>
            </div>
          </ng-container>
        </ng-container>
      </div>
    </ng-container>

    <!-- Separador elegante -->
    <div class="divider"></div>

    <!-- Botón de salir -->
    <a class="nav-link logout-button" (click)="logout()">
      <i class="bi bi-box-arrow-left"></i>
      <span class="description">Cerrar Sesión</span>
    </a>
  </nav>
</div>

<!-- Área principal del contenido -->
<div class="main-content">
  <div class="content-box">
    <div class="icon-box">
      <i class="bi bi-shield-lock-fill"></i>
    </div>

    <h1>Sistema de Gestión de Seguridad</h1>
    <p>Proyecto Análisis de Sistemas II</p>

    <!-- Información del usuario en el área principal -->
    <div *ngIf="usuarioActual" class="user-main-info">
      <div class="user-header">
        <div class="user-avatar">
          <i class="bi bi-person-fill"></i>
        </div>
        <div>
          <div class="user-name">{{ usuarioActual.nombre }} {{ usuarioActual.apellido }}</div>
          <div class="user-status">Sesión activa</div>
        </div>
      </div>

      <div class="user-role-box">
        <i class="bi bi-shield-check-fill" [style.color]="esAdmin() ? '#ff6b6b' : '#4ecdc4'"></i>
        <span [style.color]="esAdmin() ? '#ff6b6b' : '#4ecdc4'">
          {{ esAdmin() ? 'Administrador' : 'Usuario' }}
        </span>
      </div>
    </div>
  </div>
</div>

<!-- CSS adicional -->
<style>
/* Info de usuario en sidebar */
.user-info {
  padding: 1.5rem 1rem;
  margin: 1rem;
  margin-bottom: 1.5rem;
  background: rgba(255,255,255,0.05);
  border: 2px solid rgba(255,255,255,0.1);
  border-radius: 8px;
}
.welcome-text { color: rgba(255,255,255,0.7); font-size: 0.85rem; margin-bottom: 0.3rem; }
.user-name { font-weight: 600; color: #fff; font-size: 1.1rem; }
.user-role { color: rgba(255,255,255,0.8); font-size: 0.8rem; margin-top: 0.5rem; }
.role-admin { color: #ff6b6b; font-weight: 500; }
.role-user { color: #4ecdc4; font-weight: 500; }

/* Botones principales (módulos) */
.module-header {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  font-weight: 600;
  border-radius: 10px;
  margin: 0.5rem 1rem;
  padding: 1rem 1.2rem;
  box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
  transition: all 0.3s ease;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.module-header:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
}
.module-header .icon { margin-right: 0.8rem; font-size: 1.1rem; }

/* Submenús */
.submenu-header {
  background: rgba(255, 255, 255, 0.1);
  color: rgba(255, 255, 255, 0.9);
  border-radius: 8px;
  margin: 0.5rem 1rem;
  padding: 0.8rem 1rem;
  transition: all 0.3s ease;
  cursor: pointer;
  border-left: 3px solid transparent;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.submenu-header.active {
  background: rgba(255,255,255,0.15);
  border-left-color: #4ecdc4;
}
.badges { display: flex; align-items: center; gap: 0.5rem; }
.badge-admin {
  background: #ff6b6b; color: white; font-size: 0.7rem;
  padding: 0.2rem 0.5rem; border-radius: 12px; font-weight: 500;
}
.badge-restricted {
  background: rgba(149, 165, 166, 0.8); color: white; font-size: 0.7rem;
  padding: 0.2rem 0.5rem; border-radius: 12px;
}

/* Opciones */
.option-link {
  background: rgba(255,255,255,0.05);
  color: rgba(255,255,255,0.85);
  border-radius: 6px;
  margin: 0.3rem 1.5rem;
  padding: 0.7rem 1rem;
  transition: all 0.3s ease;
  text-decoration: none;
  border-left: 2px solid transparent;
  display: flex;
  align-items: center;
}
.option-link:hover {
  background: rgba(255,255,255,0.15);
  border-left-color: #4ecdc4;
  transform: translateX(5px);
}
.option-link.active {
  background: rgba(78, 205, 196, 0.2);
  border-left-color: #4ecdc4;
  color: #4ecdc4;
}
.option-link .icon { margin-right: 0.8rem; color: #4ecdc4; }
.sensitive-icon { margin-left: auto; color: #ff6b6b; font-size: 0.8rem; }
.no-permisos {
  background: rgba(149, 165, 166, 0.1);
  color: rgba(255,255,255,0.6);
  border-radius: 6px;
  margin: 0.3rem 1.5rem;
  padding: 0.7rem 1rem;
  font-style: italic;
  text-align: center;
}

/* Animaciones submenú */
.sub-menu {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease-out;
}
.sub-menu.open {
  max-height: 500px;
  transition: max-height 0.3s ease-in;
}

/* Divider */
.divider {
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
  margin: 2rem 1rem;
}

/* Botón logout */
.logout-button {
  background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
  color: white;
  font-weight: 600;
  border-radius: 10px;
  margin: 1rem;
  padding: 1rem 1.2rem;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4);
  display: flex;
  align-items: center;
  justify-content: center;
}
.logout-button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(255, 107, 107, 0.6);
}
.logout-button i { margin-right: 0.8rem; font-size: 1.1rem; }

/* Contenido principal */
.main-content {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 70vh;
}
.content-box {
  background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
  box-shadow: 0 20px 60px rgba(0,0,0,0.1);
  border-radius: 20px;
  padding: 4rem 5rem;
  text-align: center;
  min-width: 600px;
  border: 1px solid rgba(255,255,255,0.2);
}
.icon-box {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  width: 80px;
  height: 80px;
  border-radius: 20px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 2rem;
  box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
}
.icon-box i { font-size: 2.5rem; color: white; }
.content-box h1 {
  font-size: 3rem;
  color: #2c3e50;
  font-family: 'Segoe UI', 'Roboto', Arial, sans-serif;
  font-weight: 700;
  margin-bottom: 1rem;
  letter-spacing: -1px;
}
.content-box p {
  font-size: 1.2rem;
  color: #666;
  margin-bottom: 2rem;
  max-width: 500px;
  margin-left: auto;
  margin-right: auto;
}

/* Info usuario en main */
.user-main-info {
  background: rgba(102, 126, 234, 0.1);
  border-radius: 12px;
  padding: 1.5rem;
  margin-top: 2rem;
}
.user-header { display: flex; align-items: center; justify-content: center; margin-bottom: 1rem; }
.user-avatar {
  background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%);
  width: 40px; height: 40px;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  margin-right: 1rem;
}
.user-avatar i { color: white; font-size: 1.2rem; }
.user-status { color: #666; font-size: 0.9rem; }
.user-role-box {
  display: inline-flex;
  align-items: center;
  background: white;
  padding: 0.5rem 1rem;
  border-radius: 20px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
  font-weight: 500;
  gap: 0.5rem;
}
</style>
