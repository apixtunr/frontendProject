<div class="container my-4">
  <h2 class="mb-4 text-center">Registrar Movimiento CXC</h2>

  <div *ngIf="message" class="alert alert-info">{{ message }}</div>

  <div class="card mb-4">
    <div class="card-body">
      <form [formGroup]="movimientoForm" (ngSubmit)="submit()">
        <div class="row g-3">
          <div class="col-md-4">
            <label class="form-label">Persona</label>
            <select
              class="form-select"
              formControlName="idPersona"
              (change)="onPersonaChange()"
            >
              <option [ngValue]="null">Seleccione persona</option>
              <option *ngFor="let p of personas" [ngValue]="p.idPersona">
                {{ p.nombreCompleto }}
              </option>
            </select>
            <div
              *ngIf="
                movimientoForm.get('idPersona')?.touched &&
                movimientoForm.get('idPersona')?.invalid
              "
              class="text-danger small"
            >
              Persona requerida
            </div>
          </div>

          <div class="col-md-4">
            <label class="form-label">Cuenta</label>
            <select class="form-select" formControlName="idSldCuenta">
              <option [ngValue]="null">Seleccione cuenta</option>
              <option *ngFor="let c of cuentas" [ngValue]="c.idSaldoCuenta">
                {{ c.nombreTipoSaldo }}
              </option>
            </select>
            <div
              *ngIf="
                movimientoForm.get('idSldCuenta')?.touched &&
                movimientoForm.get('idSldCuenta')?.invalid
              "
              class="text-danger small"
            >
              Cuenta requerida
            </div>
            <div
              *ngIf="!cuentas || cuentas.length === 0"
              class="text-muted small mt-1"
            >
              Seleccione una persona para cargar cuentas
            </div>
          </div>

          <div class="col-md-4">
            <label class="form-label">Tipo Movimiento</label>
            <select class="form-select" formControlName="idTM">
              <option [ngValue]="null">Seleccione tipo</option>
              <option *ngFor="let t of tipos" [ngValue]="t.idTipoMovimientoCxc">
                {{ t.nombre }}
              </option>
            </select>
            <div
              *ngIf="
  movimientoForm.get('idTM')?.touched &&
  movimientoForm.get('idTM')?.errors?.['required']
"
              class="text-danger small"
            >
              Tipo requerido
            </div>
          </div>

          <div class="col-md-4 mt-3">
            <label class="form-label">Monto</label>
            <input
              type="number"
              step="0.01"
              formControlName="monto"
              class="form-control"
              placeholder="0.00"
            />
            <div
              *ngIf="
                movimientoForm.get('monto')?.touched &&
                movimientoForm.get('monto')?.invalid
              "
              class="text-danger small"
            >
              Monto inválido
            </div>
          </div>

          <div class="col-md-8 mt-3">
            <label class="form-label">Descripción (opcional)</label>
            <input
              type="text"
              formControlName="descripcion"
              class="form-control"
              placeholder="Descripción"
            />
          </div>
        </div>

        <div class="mt-4 d-flex gap-2">
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="movimientoForm.invalid || loading"
          >
            {{ loading ? "Guardando..." : "Registrar Movimiento" }}
          </button>
          <button
            type="button"
            class="btn btn-secondary"
            (click)="movimientoForm.reset(); cuentas = []; message = ''"
          >
            Limpiar
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
